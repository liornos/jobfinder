<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="1400" height="900" viewBox="0 0 1400 900" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="10" refY="5" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L10,5 L0,10 z" fill="black" />
    </marker>
    <style>
      .box { fill:#f7f9fc; stroke:#333; stroke-width:1.5; rx:12; ry:12; }
      .title { font-family:Segoe UI, Roboto, Arial, sans-serif; font-weight:700; font-size:16px; fill:#111; }
      .text { font-family:Segoe UI, Roboto, Arial, sans-serif; font-size:14px; fill:#333; }
      .label { font-family:Segoe UI, Roboto, Arial, sans-serif; font-size:13px; fill:#111; }
      .group-title { font-family:Segoe UI, Roboto, Arial, sans-serif; font-weight:700; font-size:14px; fill:#222; }
      .line { stroke:#333; stroke-width:1.5; marker-end:url(#arrow); }
      .dashed { stroke-dasharray:6 4; }
    </style>
  </defs>

  <!-- Header -->
  <text x="700" y="40" text-anchor="middle" class="title" style="font-size:22px;">JobFinder – Architecture</text>

  <!-- Browser UI -->
  <rect x="60" y="80" width="380" height="150" class="box"/>
  <text x="80" y="110" class="title">Browser UI</text>
  <text x="80" y="135" class="text">• index.html + static/app.js</text>
  <text x="80" y="160" class="text">• User selects cities, sources, keywords</text>
  <text x="80" y="185" class="text">• Calls /discover and /scan (JSON)</text>

  <!-- Flask API -->
  <rect x="520" y="80" width="380" height="220" class="box"/>
  <text x="540" y="110" class="title">Flask API (jobfinder/api.py)</text>
  <text x="540" y="135" class="text">• Routes: /discover, /scan, /debug/providers</text>
  <text x="540" y="160" class="text">• Validates & normalizes input</text>
  <text x="540" y="185" class="text">• Friendly errors (e.g., "MISSING API KEY")</text>
  <text x="540" y="210" class="text">• Delegates to pipeline.discover / pipeline.scan</text>

  <!-- Pipeline discover -->
  <rect x="980" y="60" width="360" height="220" class="box"/>
  <text x="1000" y="90" class="title">pipeline.discover</text>
  <text x="1000" y="115" class="text">• Needs SERPAPI_API_KEY</text>
  <text x="1000" y="140" class="text">• For each (provider, city):</text>
  <text x="1020" y="165" class="text">– Query SerpAPI: site:&lt;host&gt; "city" keywords</text>
  <text x="1000" y="190" class="text">• Extract org slug from URL’s first path segment</text>
  <text x="1000" y="215" class="text">• Deduplicate & cap results by limit</text>

  <!-- SerpAPI -->
  <rect x="980" y="300" width="360" height="120" class="box"/>
  <text x="1000" y="330" class="title">SerpAPI (Google)</text>
  <text x="1000" y="355" class="text">• boards.greenhouse.io, jobs.lever.co,</text>
  <text x="1000" y="380" class="text">  jobs.ashbyhq.com, jobs.smartrecruiters.com</text>

  <!-- Connections: UI -> API -> Discover -->
  <line x1="440" y1="155" x2="520" y2="155" class="line"/>
  <line x1="900" y1="155" x2="980" y2="155" class="line"/>
  <line x1="1160" y1="280" x2="1160" y2="300" class="line"/>

  <!-- Pipeline scan -->
  <rect x="520" y="340" width="380" height="300" class="box"/>
  <text x="540" y="370" class="title">pipeline.scan</text>
  <text x="540" y="395" class="text">• Dynamic import providers (greenhouse/lever/smartrecruiters/ashby)</text>
  <text x="540" y="420" class="text">• fetch_jobs(org) → raw postings</text>
  <text x="540" y="445" class="text">• Normalize to common schema</text>
  <text x="540" y="470" class="text">• Score (filtering.score)</text>
  <text x="540" y="495" class="text">• City guard (location contains any city)</text>
  <text x="540" y="520" class="text">• apply_filters (compat shim)</text>
  <text x="540" y="545" class="text">• Title keyword filter (optional)</text>
  <text x="540" y="570" class="text">• Deduplicate by id/url</text>

  <!-- Providers group -->
  <rect x="980" y="470" width="360" height="270" class="box"/>
  <text x="1000" y="500" class="title">Providers (public endpoints)</text>
  <text x="1000" y="525" class="text">• Greenhouse → boards-api.greenhouse.io</text>
  <text x="1000" y="550" class="text">• Lever → jobs.lever.co/&lt;org&gt;.json</text>
  <text x="1000" y="575" class="text">• SmartRecruiters → api.smartrecruiters.com</text>
  <text x="1000" y="600" class="text">• Ashby → (stub) GraphQL later</text>

  <!-- Connections: API -> scan -> providers -->
  <line x1="710" y1="300" x2="710" y2="340" class="line"/>
  <line x1="900" y1="520" x2="980" y2="520" class="line"/>
  <line x1="900" y1="560" x2="980" y2="560" class="line dashed"/>
  <line x1="900" y1="600" x2="980" y2="600" class="line dashed"/>

  <!-- Responses back to API/UI -->
  <line x1="980" y1="700" x2="900" y2="700" class="line"/>
  <line x1="710" y1="640" x2="710" y2="710" class="line"/>
  <rect x="520" y="710" width="380" height="120" class="box"/>
  <text x="540" y="740" class="title">API Response → UI</text>
  <text x="540" y="765" class="text">• /discover → companies[]</text>
  <text x="540" y="790" class="text">• /scan → results[] (jobs)</text>

  <!-- Legend -->
  <rect x="60" y="260" width="380" height="150" class="box"/>
  <text x="80" y="290" class="title">Legend / Notes</text>
  <text x="80" y="315" class="text">• Dashed lines: optional or best-effort paths</text>
  <text x="80" y="340" class="text">• Errors: clear messages (e.g., "MISSING API KEY")</text>
  <text x="80" y="365" class="text">• Run API from your venv: python -m jobfinder.api</text>
</svg>
