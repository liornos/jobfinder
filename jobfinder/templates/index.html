<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light" />
  <title>jobfinder 0.3.0 • Companies & Jobs</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-cyan-50 text-slate-900"
      data-auto-refresh-on-start="{{ '1' if auto_refresh_on_start else '0' }}"
      data-refresh-endpoint="{{ '/debug/refresh' if show_refresh_report else '/refresh' }}"
      data-refresh-enabled="{{ '1' if refresh_endpoint_enabled else '0' }}"
      data-testid="jobfinder-page">
  <div class="max-w-7xl mx-auto p-6">
    <header class="mb-6 grid gap-3 sm:grid-cols-[1fr_auto_1fr] sm:items-center">
      <div class="hidden sm:block"></div>
      <div class="flex items-center justify-center gap-4 text-center">
        <img src="/static/jobfinder-image.png" alt="JobFinder logo" class="h-24 w-32 rounded-2xl shadow-md object-cover">
        <div class="text-center">
          <h1 class="text-3xl font-bold">
            JobFinder
          </h1>
          <p class="text-sm text-slate-600">Discover companies & fetch jobs from ATS providers</p>
        </div>
      </div>
      <div class="flex justify-center sm:justify-end">
        <a href="/search"
           class="rounded-xl px-4 py-2 border border-emerald-100 text-emerald-700 bg-white hover:bg-emerald-50 focus:outline-none focus:ring-2 focus:ring-emerald-200">
          Quick search
        </a>
      </div>

    </header>

    <section class="grid lg:grid-cols-3 gap-4 mb-6">
      <!-- Discover -->
      <div class="p-4 bg-white/95 border border-blue-50 rounded-2xl shadow-xl shadow-blue-100">
        <div class="flex items-start justify-between gap-3">
          <h2 class="font-semibold mb-2">Discover Companies by location</h2>
          <span class="text-xs text-gray-500">Tip: add multiple cities</span>
        </div>

        <label for="citiesSelect" class="block text-sm font-medium">Cities</label>
        <select id="citiesSelect"
                data-default-cities="Tel Aviv, Herzliya"
                class="w-full border rounded-xl px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-black/20"
                data-testid="city-select">
          <option value="">Choose a city or district</option>
          <option value="__all__">Israel - All</option>
          <optgroup label="Cities">
            <option value="Tel Aviv">Tel Aviv</option>
            <option value="Herzliya">Herzliya</option>
            <option value="Kfar Saba">Kfar Saba</option>
            <option value="Raanana">Raanana</option>
            <option value="Petach Tikva">Petach Tikva</option>
            <option value="Hod Hasharon">Hod Hasharon</option>
            <option value="Netanya">Netanya</option>
            <option value="Ramat Gan">Ramat Gan</option>
            <option value="Bnei Brak">Bnei Brak</option>
            <option value="Holon">Holon</option>
            <option value="Rehovot">Rehovot</option>
            <option value="Airport City">Airport City</option>
            <option value="Binyamina">Binyamina</option>
            <option value="Caesarea">Caesarea</option>
            <option value="Haifa">Haifa</option>
            <option value="Jerusalem">Jerusalem</option>
            <option value="Yokneam Illit">Yokneam Illit</option>
          </optgroup>
          <optgroup label="Districts">
            <option value="Tel Aviv, Ramat Gan, Petach Tikva">Tel Aviv District</option>
            <option value="Herzliya, Kfar Saba, Raanana, Hod Hasharon">Hasharon District</option>
            <option value="Haifa, Yokneam Illit, Caesarea">Haifa District</option>
            <option value="Jerusalem">Jerusalem District</option>
          </optgroup>
        </select>
        <div class="mt-2 flex items-center justify-between text-xs text-slate-500">
          <span>Selected</span>
          <button id="citiesClear" type="button" class="hover:text-slate-700" data-testid="cities-clear">Clear</button>
        </div>
        <div id="citiesSelected" class="mt-1 mb-2 flex flex-wrap gap-2" data-testid="cities-selected"></div>

        <label for="keywords" class="block text-sm font-medium">Company type</label>
        <input id="keywords"
               class="w-full border rounded-xl px-3 py-2 mb-2 bg-white focus:outline-none focus:ring-2 focus:ring-black/20"
               value="software"
               placeholder="software, fintech, ai">

        <!-- Advanced discover options -->
        <details class="mt-2">
          <summary class="cursor-pointer text-sm text-gray-700 select-none">Advanced</summary>
          <div class="mt-3 grid gap-3">
            <div>
              <label for="sources" class="block text-sm font-medium">Sources</label>
              <select id="sources" multiple size="5"
                      class="w-full border rounded-xl px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-black/20">
                <!-- Keep defaults aligned to backend discover providers -->
                <option value="greenhouse" selected>greenhouse</option>
                <option value="lever" selected>lever</option>
                <option value="ashby">ashby</option>
                <option value="smartrecruiters" selected>smartrecruiters</option>
                <option value="breezy" selected>breezy</option>
                <option value="comeet" selected>comeet</option>
                <option value="workday" selected>workday</option>
                <option value="recruitee" selected>recruitee</option>
                <option value="jobvite" selected>jobvite</option>
                <option value="icims" selected>icims</option>
                <option value="workable" selected>workable</option>
              </select>
              <p class="text-xs text-gray-500 mt-1">Hold Ctrl/⌘ to select multiple.</p>
            </div>

            <div class="grid grid-cols-2 gap-2">
              <div>
                <label for="limit" class="block text-sm font-medium">Discover limit</label>
                <input id="limit" type="number" min="10" step="10" value="1000"
                       class="w-full border rounded-xl px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-black/20">
              </div>
              <div>
                <label for="radius" class="block text-sm font-medium">Radius (km)</label>
                <input id="radius" type="number" min="0" step="1" value="0"
                       class="w-full border rounded-xl px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-black/20">
              </div>
            </div>

            <div class="text-xs text-gray-500">
              If SerpAPI key is missing, the UI will load seed companies from <code>/static/companies.json</code>.
            </div>
          </div>
        </details>

        <button id="btnDiscover" type="button"
                class="w-full mt-4 rounded-2xl px-3 py-2 bg-gradient-to-r from-emerald-500 to-blue-500 text-white flex items-center justify-center gap-2
                       hover:shadow-lg hover:shadow-emerald-200 active:opacity-90 focus:outline-none focus:ring-2 focus:ring-emerald-200"
                data-testid="discover-button">
          <span id="discoverBtnText">Discover companies</span>
          <span id="discoverSpinner"
                class="hidden h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin"></span>
        </button>

        <p id="discoverMsg" class="text-base font-semibold mt-3" role="status" aria-live="polite" data-testid="discover-message"></p>
      </div>

      <!-- Companies -->
      <div class="p-4 bg-white/95 border border-blue-50 rounded-2xl shadow-xl shadow-blue-100" id="companiesPanel" style="display:none;" data-testid="companies-panel">
        <div class="flex items-center justify-between mb-2">
          <h2 class="font-semibold">Companies</h2>
          <div class="space-x-2">
            <button id="btnClear" type="button"
                    class="rounded-xl px-3 py-2 border border-emerald-100 text-emerald-700 bg-white hover:bg-emerald-50 focus:outline-none focus:ring-2 focus:ring-emerald-200">
              Clear
            </button>
          </div>
        </div>

        <div class="overflow-auto max-h-64 rounded-xl border">
          <table class="w-full text-sm table-fixed" id="companiesTable" data-testid="companies-table">
            <thead class="sticky top-0 bg-gray-100">
              <tr>
                <th class="p-2 w-10"><input type="checkbox" id="selectAll" class="h-4 w-4 accent-black" data-testid="companies-select-all"></th>
                <th class="p-2 text-left">Name</th>
              </tr>
            </thead>
            <tbody id="companiesBody" data-testid="companies-body"></tbody>
          </table>
        </div>

        <p class="text-xs text-gray-500 mt-2">Tip: select a few companies, then refresh jobs.</p>
      </div>

      <!-- Refresh & Filters -->
      <div class="p-4 bg-white/95 border border-blue-50 rounded-2xl shadow-xl shadow-blue-100" id="scanFiltersPanel" style="display:none;" data-testid="refresh-panel">
        <div class="flex items-start justify-between">
          <h2 class="font-semibold mb-2">Refresh & Filters</h2>
          <span class="text-xs text-gray-500">Refresh stores to DB; filters query the DB</span>
        </div>

        <div class="grid grid-cols-2 gap-2">
          <div>
            <label for="fltScore" class="block text-sm font-medium">Min score</label>
            <input id="fltScore" type="number" value="0"
                   class="w-full border rounded-xl px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-black/20">
          </div>

          <div>
            <label for="fltAge" class="block text-sm font-medium">Max age (days)</label>
            <input id="fltAge" type="number" value="" placeholder="e.g., 7"
                   class="w-full border rounded-xl px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-black/20">
          </div>
        </div>

        <div class="mt-3">
          <label for="fltTitle" class="block text-sm font-medium">Title keywords</label>
          <input id="fltTitle" type="text" placeholder="software engineer, automation, qa"
                 class="w-full border rounded-xl px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-black/20"
                 data-testid="title-filter">
        </div>

        <details class="mt-3">
          <summary class="cursor-pointer text-sm text-gray-700 select-none">More filters</summary>
          <div class="mt-3 grid gap-2">
            <div>
              <label for="fltProvider" class="block text-sm font-medium">Provider</label>
              <select id="fltProvider"
                      class="w-full border rounded-xl px-3 py-2 bg-white focus:outline-none focus:ring-2 focus:ring-black/20">
                <option value="">All</option>
                <option value="greenhouse">greenhouse</option>
                <option value="lever">lever</option>
                <option value="ashby">ashby</option>
                <option value="smartrecruiters">smartrecruiters</option>
                <option value="breezy">breezy</option>
                <option value="comeet">comeet</option>
                <option value="workday">workday</option>
                <option value="recruitee">recruitee</option>
                <option value="jobvite">jobvite</option>
                <option value="icims">icims</option>
              </select>
            </div>
          </div>
        </details>

        <div class="mt-4">
          <button id="btnScanSelected" type="button"
                  class="w-full rounded-2xl px-3 py-2 bg-gradient-to-r from-blue-600 to-cyan-500 text-white flex items-center justify-center gap-2
                         hover:shadow-lg hover:shadow-cyan-200 active:opacity-90 focus:outline-none focus:ring-2 focus:ring-cyan-200"
                  aria-live="polite"
                  data-testid="refresh-button">
            <span id="scanBtnText">Refresh jobs</span>
            <span id="scanSpinner" class="hidden h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin"></span>
          </button>

          <p id="scanMsg" class="text-sm text-gray-600 mt-2" role="status" aria-live="polite" data-testid="refresh-message"></p>

        </div>
      </div>

      {% if show_refresh_report %}
      <!-- Refresh Report -->
      <div class="col-span-full p-4 bg-white/95 border border-blue-50 rounded-2xl shadow-xl shadow-blue-100"
           id="refreshReportPanel"
           style="display:none;">
        <div class="flex items-start justify-between gap-3">
          <h2 class="font-semibold mb-1">Refresh report</h2>
          <span id="refreshReportTime" class="text-xs text-gray-500"></span>
        </div>

        <div class="grid grid-cols-2 gap-2 text-sm mb-3">
          <div class="rounded-xl border border-slate-100 bg-slate-50 p-2">
            <div class="text-xs text-slate-500">Companies</div>
            <div class="font-semibold">
              <span id="reportCompaniesOk">0</span> ok /
              <span id="reportCompaniesFailed">0</span> failed
            </div>
            <div class="text-xs text-slate-500">
              Total: <span id="reportCompaniesTotal">0</span>
            </div>
          </div>
          <div class="rounded-xl border border-slate-100 bg-slate-50 p-2">
            <div class="text-xs text-slate-500">Jobs</div>
            <div class="font-semibold">
              <span id="reportJobsWritten">0</span> written
            </div>
            <div class="text-xs text-slate-500">
              Fetched: <span id="reportJobsFetched">0</span>
            </div>
          </div>
          <div class="rounded-xl border border-slate-100 bg-slate-50 p-2">
            <div class="text-xs text-slate-500">Elapsed</div>
            <div class="font-semibold" id="reportElapsed">0 ms</div>
          </div>
          <div class="rounded-xl border border-slate-100 bg-slate-50 p-2">
            <div class="text-xs text-slate-500">Last run</div>
            <div class="font-semibold" id="reportLastRun">-</div>
          </div>
        </div>

        <div class="overflow-auto max-h-64 rounded-xl border">
          <table class="w-full text-sm table-auto">
            <thead class="sticky top-0 bg-gray-100">
              <tr>
                <th class="p-2 text-left">Company</th>
                <th class="p-2 text-left w-24">Status</th>
                <th class="p-2 text-right w-20">Fetched</th>
                <th class="p-2 text-right w-20">Written</th>
                <th class="p-2 text-left">Error</th>
              </tr>
            </thead>
            <tbody id="refreshReportBody"></tbody>
          </table>
        </div>
        <p class="text-xs text-gray-500 mt-2">Shows the most recent refresh run.</p>
      </div>
      {% endif %}
    </section>

    <!-- Jobs -->
    <section class="p-4 bg-white/95 border border-blue-50 rounded-2xl shadow-xl shadow-blue-100">
      <div class="flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between mb-3">
        <div class="font-semibold">Jobs</div>

        <div class="flex flex-wrap items-center gap-2 text-sm">
          <div><span id="jobsCount" data-testid="jobs-count">0</span> results (<span id="newCount">0</span> new)</div>

          <label class="inline-flex items-center gap-2">
            <span>Page size</span>
            <select id="pageSize" class="border rounded-lg px-2 py-1 bg-white focus:outline-none focus:ring-2 focus:ring-black/20">
              <option>25</option><option selected>50</option><option>100</option>
            </select>
          </label>

          <button id="prevPage" type="button"
                  class="border rounded-lg px-3 py-1 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed
                         focus:outline-none focus:ring-2 focus:ring-black/20">
            Prev
          </button>
          <span id="pageInfo">1 / 1</span>
          <button id="nextPage" type="button"
                  class="border rounded-lg px-3 py-1 bg-white hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed
                         focus:outline-none focus:ring-2 focus:ring-black/20">
            Next
          </button>
        </div>
      </div>

      <div class="overflow-auto rounded-xl border">
        <table class="min-w-full text-sm" id="jobsTable" data-testid="jobs-table">
          <thead class="bg-gray-100 sticky top-0">
            <tr>
              <th class="p-2 sort cursor-pointer select-none" data-key="score" title="Sort by score">Score</th>
              <th class="p-2 sort cursor-pointer select-none" data-key="title" title="Sort by title">Title</th>
              <th class="p-2 sort cursor-pointer select-none" data-key="company" title="Sort by company">Company</th>
              <th class="p-2 sort cursor-pointer select-none" data-key="location" title="Sort by location">Location</th>
              <th class="p-2 sort cursor-pointer select-none" data-key="provider" title="Sort by provider">Provider</th>
              <th class="p-2 sort cursor-pointer select-none" data-key="created_at" title="Sort by date">Date</th>
              <th class="p-2">Link</th>
            </tr>
          </thead>
          <tbody id="jobsBody" data-testid="jobs-body"></tbody>
        </table>
      </div>

      <p class="text-xs text-gray-500 mt-2">Tip: click a job row to open details drawer.</p>
    </section>
  </div>

  <!-- Drawer -->
  <div id="drawer" class="hidden fixed inset-0 bg-black/30">
    <div class="absolute right-0 top-0 bottom-0 w-full max-w-2xl bg-white shadow-xl p-6 overflow-y-auto">
      <button id="closeDrawer" type="button"
              class="border rounded-lg px-3 py-1 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-black/20 mb-4">
        Close
      </button>
      <div id="drawerContent"></div>
    </div>
  </div>
<script src="/static/app.js?v=6" defer></script>
</body>
</html>
